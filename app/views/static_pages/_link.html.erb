<% header = header || false %>
<% opens_new_tab = opens_new_tab || false %>
<% top_active = @page && @page == page %>
<% top_active ||= @page && page.children.collect(&:id).include?(@page.id) %>

<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle <%= top_active ? 'active' : '' %>" data-toggle="dropdown" href="#" role="button"><%= page.title %></a>
  <div class="dropdown-menu">
    <% if page.link %>
      <%= link_to(
                   page.title,
                   page.link,
                   {
                     class: "dropdown-item #{(@page && @page == page)? 'active' : ''}",
                     target: page.is_external? || opens_new_tab ? "_blank" : "_self",
                     name: CGI.escape(page.title.downcase)
                   }
                 )
      %>
    <% end %>
    <% if page.children.any? %>
      <% page.children.each do |child| %>
        <%# TODO: nested menu %>
        <%# See https://codepen.io/svnt/pen/beEgre %>
        <% if child.visible && (header ? child.show_in_header : child.show_in_footer) %>
          <%= link_to(
                       child.title,
                       child.link,
                       {
                         class: "dropdown-item #{(@page && @page == child)? 'active' : ''}",
                         target: child.is_external? || opens_new_tab ? "_blank" : "_self",
                         name: CGI.escape(child.title.downcase)
                       }
                     )
          %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</li>
